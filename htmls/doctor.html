<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Doctor Dashboard - PathoAI</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2f8bc1",
                        "background-light": "#f6f7f8",
                        "background-dark": "#131b1f",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .dropdown-menu {
            display: none;
        }
        .dropdown-menu.active {
            display: block;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen text-[#101619] dark:text-gray-100 transition-colors duration-200">
    <!-- Main Layout Container -->
    <div class="flex flex-col min-h-screen">
        <!-- TopNavBar -->
        <header class="w-full bg-white dark:bg-[#1a2429] border-b border-[#e9eef1] dark:border-gray-800 sticky top-0 z-50">
            <div class="max-w-[1200px] mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
                <!-- Logo Section -->
                <div class="flex items-center gap-3">
                    <div class="size-8 bg-primary rounded-lg flex items-center justify-center text-white">
                        <span class="material-symbols-outlined !text-[20px]">radiology</span>
                    </div>
                    <h2 class="text-[#101619] dark:text-white text-lg md:text-xl font-bold tracking-tight">Chest <span class="text-primary">Pathology</span></h2>
                </div>

                <!-- Right Actions -->
                <div class="flex items-center gap-2 md:gap-4">
                    <!-- Dark Mode Toggle -->
                    <button id="themeToggle" class="p-2 rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                        <span class="material-symbols-outlined">light_mode</span>
                    </button>

                    <!-- Profile Dropdown -->
                    <div class="relative">
                        <!-- Profile Button -->
                        <button id="profileBtn" class="flex items-center gap-2 p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                            <div class="h-9 w-9 md:h-10 md:w-10 rounded-full bg-cover bg-center border-2 border-primary/20 flex-shrink-0" id="profileImage" title="Doctor profile">
                            </div>
                            <span class="hidden md:inline text-sm font-medium text-[#101619] dark:text-white truncate">{{ username }}</span>
                        </button>

                        <!-- Dropdown Menu -->
                        <div id="dropdownMenu" class="dropdown-menu absolute right-0 mt-2 w-48 bg-white dark:bg-[#1a2429] rounded-xl shadow-lg border border-[#e9eef1] dark:border-gray-800 overflow-hidden">
                            <!-- Profile Section -->
                            <div class="px-4 py-3 border-b border-[#e9eef1] dark:border-gray-800">
                                <p class="text-sm font-bold text-[#101619] dark:text-white truncate">{{ username }}</p>
                                <p class="text-xs text-[#577a8e] dark:text-gray-400 truncate">{{ email }}</p>
                            </div>

                            <!-- Menu Items -->
                            <div class="py-2">
                                <button class="w-full px-4 py-2 text-left text-sm text-[#101619] dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="material-symbols-outlined !text-[18px]">person</span>
                                    Profile
                                </button>
                                <button class="w-full px-4 py-2 text-left text-sm text-[#101619] dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="material-symbols-outlined !text-[18px]">settings</span>
                                    Settings
                                </button>
                            </div>

                            <!-- Logout Section -->
                            <div class="border-t border-[#e9eef1] dark:border-gray-800 py-2">
                                <form action="/logout" method="GET">
                                    <button type="submit" class="w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-3 transition-colors font-medium">
                                        <span class="material-symbols-outlined !text-[18px]">logout</span>
                                        Logout
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col items-center py-8 md:py-12 px-4 md:px-6">
            <div class="w-full max-w-[800px] space-y-8">
                <!-- Page Heading -->
                <div class="text-center md:text-left space-y-2">
                    <h1 class="text-2xl md:text-4xl text-[#101619] dark:text-white font-black tracking-tight">Chest Pathology Analysis</h1>
                    <p class="text-base md:text-lg text-[#577a8e] dark:text-gray-400">Upload a high-resolution chest X-ray to begin AI-driven detection.</p>
                </div>

                <!-- Central Upload Card -->
                <form action="/predict" method="POST" enctype="multipart/form-data" id="analysisForm" class="bg-white dark:bg-[#1a2429] rounded-xl shadow-sm border border-[#e9eef1] dark:border-gray-800 overflow-hidden">
    <div class="p-6 md:p-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
            <h3 class="text-lg md:text-xl text-[#101619] dark:text-white font-bold flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">upload_file</span>
                Digital Imaging & Communications
            </h3>
            <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-bold rounded-full uppercase tracking-wider whitespace-nowrap">DICOM Compatible</span>
        </div>

        <div class="relative group">
            <div class="flex flex-col items-center justify-center gap-6 rounded-xl border-2 border-dashed border-[#d3dee4] dark:border-gray-700 bg-gray-50/50 dark:bg-background-dark/30 px-4 md:px-6 py-12 md:py-16 hover:border-primary/50 hover:bg-primary/5 transition-all cursor-pointer" id="uploadArea">
                <div class="size-12 md:size-16 rounded-full bg-primary/10 flex items-center justify-center text-primary">
                    <span class="material-symbols-outlined !text-[32px] md:!text-[40px]">cloud_upload</span>
                </div>
                <div class="flex flex-col items-center gap-2 text-center">
                    <p class="text-lg md:text-xl text-[#101619] dark:text-white font-bold tracking-tight">Drag and drop your X-ray here</p>
                    <p class="text-xs md:text-sm text-[#577a8e] dark:text-gray-400 max-w-[400px]">
                        Support for high-resolution DICOM, JPG, and PNG files. Maximum file size is 5MB for optimized processing.
                    </p>
                </div>
                <button type="button" class="mt-4 flex items-center gap-2 px-4 md:px-6 h-10 md:h-12 bg-primary text-white rounded-xl font-bold hover:bg-primary/90 transition-transform active:scale-95 shadow-md" id="selectBtn">
                    <span class="material-symbols-outlined">add</span>
                    <span class="text-sm md:text-base">Select DICOM/Image File</span>
                </button>
                <input type="file" id="imageInput" name="image" class="hidden" accept=".jpg,.jpeg,.png,.dcm" />
            </div>
        </div>

        <div id="previewSection" class="mt-10 hidden">
            <h3 class="text-[#101619] dark:text-white text-lg font-bold mb-4">Image Preview</h3>
            <div class="aspect-[4/5] bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-300 dark:border-gray-700 relative">
                <img id="previewImage" class="w-full h-full object-cover" alt="Uploaded X-ray preview" />
            </div>
        </div>

        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 opacity-40 grayscale pointer-events-none">
            <div class="space-y-4">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Example Reference (Frontal)</p>
                <div class="aspect-[4/5] bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-300 dark:border-gray-700 relative">
                    <div class="absolute inset-0 bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDiqBToZq-3LLCQ-xkGHyEP9DfGVu3xaZMJCq6qSVHuFjjq0wNtWhFCwreLGXwSu5KB6QDf_TyHtQP_mWcfU4O_5LBMj9UvwkoWbbgPj7DQ9thfb03XLEP4ktOPp8gAD8CVL9xMM0yJa1P1Gm_lm_GQ97IWc3-4dJx2aP-w88eBlZ1BRwbUu2a7l-kau11rS7SS0uUySYrHxkqd8BgT0uUSFcsJE_zsPzWNwaFuDQh3LeaVGB5x0s1ZWcf4bGsUea-jBs0Qw4z4fxQ");'></div>
                    <div class="absolute bottom-4 right-4 bg-black/60 backdrop-blur px-2 py-1 rounded text-[10px] text-white">PA VIEW</div>
                </div>
            </div>
            <div class="space-y-4">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Example Reference (Lateral)</p>
                <div class="aspect-[4/5] bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-300 dark:border-gray-700 relative">
                    <div class="absolute inset-0 bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCAfn_Q5IsRLrYS4qDIQJmyUBMfX0JgUhOUaEDPLNIqpC9UdLXWHi9B419l-SUM0M7YJplaZmTW_Xf-3UkHRDnmhPIwvbppK4uWvl6C0gIhLIZnxRf76LZGBU36-hEXoP0O53mrXjjZQ9KpvkqMo8CB-oVPK-4zwvvksuk9ydGohMC1PBV4tNS5L6DdTj5TRhIwCCkGsvILo4nKYoiRLi3CiqXgMHsVh-UG6So1BMfkQj-dHgJ18otwCF085NHUBs5NTa0O9MPM7Bw");'></div>
                    <div class="absolute bottom-4 right-4 bg-black/60 backdrop-blur px-2 py-1 rounded text-[10px] text-white">LATERAL VIEW</div>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-gray-50 dark:bg-[#151d21] border-t border-[#e9eef1] dark:border-gray-800 px-4 md:px-8 py-4 md:py-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2 text-[#577a8e] dark:text-gray-400 text-center sm:text-left">
            <span class="material-symbols-outlined !text-[18px] hidden sm:inline">info</span>
            <p class="text-xs italic">Results require medical professional verification.</p>
        </div>
        <div class="flex items-center gap-3 w-full sm:w-auto">
            <button type="button" class="flex-1 sm:flex-none px-4 md:px-6 h-10 md:h-12 rounded-xl bg-white dark:bg-gray-800 text-[#101619] dark:text-white border border-[#d3dee4] dark:border-gray-700 font-bold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm md:text-base" id="resetBtn">
                Reset
            </button>
            <button type="submit" class="flex-1 sm:flex-none px-4 md:px-8 h-10 md:h-12 rounded-xl bg-primary text-white font-bold hover:bg-primary/90 transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2 text-sm md:text-base" id="submitBtn" disabled>
                <span class="material-symbols-outlined hidden md:inline">analytics</span>
                Submit for Analysis
            </button>
        </div>
    </div>
</form>

                    

                <!-- Guidance Section -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                    <div class="p-4 md:p-6 bg-white dark:bg-[#1a2429] rounded-xl border border-[#e9eef1] dark:border-gray-800">
                        <span class="material-symbols-outlined text-primary mb-3 block">verified</span>
                        <h4 class="font-bold mb-1 dark:text-white text-sm md:text-base">Validated Models</h4>
                        <p class="text-xs md:text-sm text-[#577a8e] dark:text-gray-400 leading-relaxed">AI models trained on 1M+ clinical chest images with high sensitivity.</p>
                    </div>
                    <div class="p-4 md:p-6 bg-white dark:bg-[#1a2429] rounded-xl border border-[#e9eef1] dark:border-gray-800">
                        <span class="material-symbols-outlined text-primary mb-3 block">lock</span>
                        <h4 class="font-bold mb-1 dark:text-white text-sm md:text-base">Privacy First</h4>
                        <p class="text-xs md:text-sm text-[#577a8e] dark:text-gray-400 leading-relaxed">Full HIPAA compliance with end-to-end encryption for all patient data.</p>
                    </div>
                    <div class="p-4 md:p-6 bg-white dark:bg-[#1a2429] rounded-xl border border-[#e9eef1] dark:border-gray-800">
                        <span class="material-symbols-outlined text-primary mb-3 block">speed</span>
                        <h4 class="font-bold mb-1 dark:text-white text-sm md:text-base">Fast Inference</h4>
                        <p class="text-xs md:text-sm text-[#577a8e] dark:text-gray-400 leading-relaxed">Receive a detailed pathology heatmap and report in under 30 seconds.</p>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="pt-6 md:pt-8 pb-6 md:pb-12 text-center">
                    <p class="text-[#577a8e] dark:text-gray-500 text-xs uppercase tracking-[0.2em] font-bold">
                        Medical Decision Support Tool â€¢ v2.4.0-Stable
                    </p>
                </footer>
            </div>
        </main>
    </div>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Load theme preference
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            html.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const newTheme = html.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
        });

        // Profile Dropdown
        const profileBtn = document.getElementById('profileBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');

        profileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle('active');
        });

        document.addEventListener('click', () => {
            dropdownMenu.classList.remove('active');
        });

        dropdownMenu.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Set Profile Image
        function setProfileImage() {
            const profileImage = document.getElementById('profileImage');
            const doctorId = '{{ doctor_id }}';
            
            if (doctorId) {
                profileImage.style.backgroundImage = `url('/public/dp/${doctorId}.jpg')`;
            } else {
                profileImage.innerHTML = '<span class="material-symbols-outlined text-gray-400">person</span>';
            }
        }

        setProfileImage();

        // File Upload Handling
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const selectBtn = document.getElementById('selectBtn');
        const resetBtn = document.getElementById('resetBtn');
        const submitBtn = document.getElementById('submitBtn');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');

        selectBtn.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImage.src = event.target.result;
                    previewSection.classList.remove('hidden');
                    submitBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#d3dee4';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#d3dee4';
            const files = e.dataTransfer.files;
            if (files[0]) {
                imageInput.files = files;
                const event = new Event('change', { bubbles: true });
                imageInput.dispatchEvent(event);
            }
        });

        resetBtn.addEventListener('click', () => {
            imageInput.value = '';
            previewSection.classList.add('hidden');
            submitBtn.disabled = true;
        });

        // Add this to your existing script
        const analysisForm = document.getElementById('analysisForm');
        const btnText = document.getElementById('btnText');

        analysisForm.addEventListener('submit', function() {
            // Disable button and show loading state
            submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
            submitBtn.innerHTML = `<span class="material-symbols-outlined animate-spin">autorenew</span> Processing...`;
            submitBtn.disabled = true;
            // The form will now submit to the server automatically
        });

        
    </script>
</body>
</html>
